<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Mirko Caserta "><meta name=description content="Vorrei proporre alcune considerazioni sulla apparentemente oscura arte dello scrivere messaggi di log. Dico apparentemente oscura perchÃ© si tratta di un argomento apparentemente banale ma che in realtÃ  si rivela complesso.
Trattandosi di osservazioni generali, queste andrebbero prese con una dose di buon senso e sotto stretta osservazione del proctologo di fiducia; ciÃ² non toglie che con ogni probabilitÃ  troverai le seguenti note ragionevolmente utili poichÃ© basate sullâ€™esperienza personale (a.k.a. sangue versato sul campo)."><meta name=keywords content=",logging,java,software development"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://mirkocaserta.com/posts/2009/10/scrivi-messaggi-di-log-decenti-altrimenti-ges%C3%B9-piange/><title>ðŸ‡®ðŸ‡¹ Scrivi messaggi di log decenti, altrimenti GesÃ¹ piange :: Mirko Caserta â€” Software Engineer</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://mirkocaserta.com/main.559c11c353d977c72bfa364708d81343a35654a99d1d1249c7e2e9210afb111e.css><link rel=apple-touch-icon sizes=180x180 href=https://mirkocaserta.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://mirkocaserta.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://mirkocaserta.com/favicon-16x16.png><link rel=manifest href=https://mirkocaserta.com/site.webmanifest><link rel=mask-icon href=https://mirkocaserta.com/safari-pinned-tab.svg color=#1b1c1d><link rel="shortcut icon" href=https://mirkocaserta.com/favicon.ico><meta name=msapplication-TileColor content="#1b1c1d"><meta name=theme-color content="#1b1c1d"><meta itemprop=name content="ðŸ‡®ðŸ‡¹ Scrivi messaggi di log decenti, altrimenti GesÃ¹ piange"><meta itemprop=description content="Vorrei proporre alcune considerazioni sulla apparentemente oscura arte dello scrivere messaggi di log. Dico apparentemente oscura perchÃ© si tratta di un argomento apparentemente banale ma che in realtÃ  si rivela complesso.
Trattandosi di osservazioni generali, queste andrebbero prese con una dose di buon senso e sotto stretta osservazione del proctologo di fiducia; ciÃ² non toglie che con ogni probabilitÃ  troverai le seguenti note ragionevolmente utili poichÃ© basate sullâ€™esperienza personale (a.k.a. sangue versato sul campo)."><meta itemprop=datePublished content="2009-10-02T08:45:00+00:00"><meta itemprop=dateModified content="2009-10-02T08:45:00+00:00"><meta itemprop=wordCount content="1043"><meta itemprop=image content="https://mirkocaserta.com"><meta itemprop=keywords content="logging,java,software development,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mirkocaserta.com"><meta name=twitter:title content="ðŸ‡®ðŸ‡¹ Scrivi messaggi di log decenti, altrimenti GesÃ¹ piange"><meta name=twitter:description content="Vorrei proporre alcune considerazioni sulla apparentemente oscura arte dello scrivere messaggi di log. Dico apparentemente oscura perchÃ© si tratta di un argomento apparentemente banale ma che in realtÃ  si rivela complesso.
Trattandosi di osservazioni generali, queste andrebbero prese con una dose di buon senso e sotto stretta osservazione del proctologo di fiducia; ciÃ² non toglie che con ogni probabilitÃ  troverai le seguenti note ragionevolmente utili poichÃ© basate sullâ€™esperienza personale (a.k.a. sangue versato sul campo)."><meta property="article:section" content="software development"><meta property="article:published_time" content="2009-10-02 08:45:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=https://mirkocaserta.com/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>cd ~mcaserta</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://mirkocaserta.com/about/>About</a></li><li><a href=https://mirkocaserta.com/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://mirkocaserta.com/posts/2009/10/scrivi-messaggi-di-log-decenti-altrimenti-ges%C3%B9-piange/>ðŸ‡®ðŸ‡¹ Scrivi messaggi di log decenti, altrimenti GesÃ¹ piange</a></h2><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents></nav></aside><hr><div class=post-content><p>Vorrei proporre alcune considerazioni sulla apparentemente oscura arte dello
scrivere messaggi di log. Dico <em>apparentemente oscura</em> perchÃ© si tratta di un
argomento apparentemente banale ma che in realtÃ  si rivela complesso.</p><p>Trattandosi di osservazioni generali, queste andrebbero prese con una dose di
buon senso e sotto stretta osservazione del proctologo di fiducia; ciÃ² non
toglie che con ogni probabilitÃ  troverai le seguenti note ragionevolmente utili
poichÃ© basate sullâ€™esperienza personale (a.k.a. sangue versato sul campo).</p><h1 id=niente-guerre-di-religione-altrimenti-feuerbach-piange>Niente guerre di religione, altrimenti Feuerbach piange</h1><p>Nel mondo java, log4j Ã¨ considerato lo standard de facto quando si parla di
framework di logging. Tuttavia, il mio consiglio Ã¨ di usare un framework piÃ¹
moderno, come slf4j o logback. Logback Ã¨ basato sullâ€™api di slf4j ed Ã¨
sufficiente dare unâ€™occhiata agli esempi nella documentazione per essere
produttivi nel giro di un quarto dâ€™ora.</p><p>Vorrei evitare di spiegare i vantaggi di questi framework rispetto a log4j o
java.util.logging perchÃ© credo lâ€™argomento sia non solo abbondantemente
trattato in letteratura ma anche facilmente foriero di guerre di religione. Le
guerre di religione sono per definizione irrazionali nonchÃ© mortalmente
noiose. Sei abbastanza intelligente da documentarti e decidere da solo.</p><p>Al di lÃ  di un eventuale framework e del linguaggio di programmazione usato, i
messaggi di log sono essenziali sia in fase di test/debug che in fase di
monitoring in produzione.</p><p>Il log Ã¨ spesso sottovalutato e trattato come una
seccatura che va espletata piÃ¹ per dovere che per una reale necessitÃ .
Tuttavia, ti posso assicurare che non câ€™Ã¨ nulla di peggio che essere chiamati a
risolvere un problema urgente in produzione e trovarsi davanti a un log
incasinato.</p><p>Nessuno ti farÃ  mai collegare col debugger in produzione. I log sono la tua
unica linea di difesa.</p><p>In particolare, nel momento in cui qualche migliaio di utenti Ã¨ in procinto di
spendere un mucchio di soldi sul sito del tuo cliente e lâ€™applicazione Ã¨
scritta da te e per qualche oscuro motivo la possibilitÃ  di tale ingente
esborso dovesse essere negata agli utenti del suddetto sito, vorrai essere
sicuro di avere la possibilitÃ  di capire velocemente cosa sta succedendo dietro
le quinte. In casi simili, dire che a scrivere male nel log GesÃ¹ piange Ã¨ al
massimo un eufemismo neanche troppo colorito.</p><h1 id=garbage-in-garbage-out>Garbage in, garbage out</h1><p>Uno dei concetti elementari del software Ã¨ quello di input/output. Conoscendo
lâ€™input e lo stato di tutte le variabili coinvolte nel processo di
elaborazione, sai che puoi aspettarti un certo output.</p><p>Se lâ€™output non Ã¨ coerente con le aspettative, vorrÃ  dire che analizzando il
contesto, lâ€™input, il codice e lo stato delle variabili locali e globali
coinvolte, dovresti riuscire a capire cosa non quadra.</p><p>Non Ã¨ necessario tracciare nel log ogni cambiamento di stato di ogni variabile,
specie se la funzione o il metodo sono sufficientemente complessi.</p><p>Esempio di log inutile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> BuyResponse <span style=color:#a6e22e>buyItem</span><span style=color:#f92672>(</span>BuyRequest request<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34; ----- buyItem ------ start -----&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34; ----- buyItem ------ stop -----&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> response<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Esempio di log piÃ¹ utile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> BuyResponse <span style=color:#a6e22e>buyItem</span><span style=color:#f92672>(</span>BuyRequest request<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;buyItem(): request={}&#34;</span><span style=color:#f92672>,</span> request<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;buyItem(): request={}, response={}&#34;</span><span style=color:#f92672>,</span> request<span style=color:#f92672>,</span> response<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> response<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>In questo modo posso controllare lâ€™input e lâ€™output del metodo. Ripetendo
lâ€™input anche allâ€™uscita del metodo, sarÃ  piÃ¹ facile correlare i messaggi in
fase di analisi. Tuttavia non sempre Ã¨ utile questo tipo di verbositÃ .</p><p>Come al solito, il buon senso dovrebbe guidarti nella scelta. Ad ogni modo,
input, output e cambiamenti di stato di variabili importanti andrebbero
tracciati almeno a livello di debug.</p><p>Assicurati che le classi che includi nei log abbiano un override sensato del
metodo <code>toString()</code>, altrimenti nei log leggerai solo un mucchio di inutili
indirizzi a puntatori e non lo stato corrente delle variabili degli oggetti.</p><h1 id=loggare-a-un-certo-livello>Loggare a un certo livello</h1><p>Tutti i framework di logging hanno un meccanismo di livelli per cui Ã¨ possibile
filtrare lâ€™output in modo da ottenere solo i messaggi che davvero ci
interessano.</p><p>Spesso capita di fare copia e incolla di statement di log per cui un messaggio
che dovrebbe essere a livello di errore invece finisce a livello di debug.
Occhio al copia e incolla!</p><h1 id=formattazione-coerente-e-senza-fronzoli>Formattazione coerente e senza fronzoli</h1><p>Cerca di mantenere uno stile coerente e senza troppi fronzoli nei messaggi di
log. Disattiva il <em>blocco maiuscole</em>, abbi pietÃ . Questo ti aiuterÃ  nella fase
di analisi ed eviterÃ  che le tue applicazioni abbiano lâ€™aspetto di una roba
scritta da uno sbarbatello in visual basic.</p><h1 id=metti-i-messaggi-in-riga>Metti i messaggi in riga</h1><p>Per quanto possibile, evita di introdurre caratteri di a capo nei messaggi di
log. Quando userai <code>grep</code> per andare alla ricerca dei messaggi, Ã¨ importante
che ad una singola riga di output corrisponda un messaggio coerente.</p><p>Allâ€™inizio, andare a capo sembra dare un aspetto migliore allâ€™output ma col
tempo ti renderai conto che avresti fatto meglio a non farlo.</p><h1 id=occhio-al-copia-e-incolla>Occhio al copia e incolla</h1><p><img src=https://mirkocaserta.com/images/posts/blinking-alarm.gif alt="Allarme rosso"></p><p>Come giÃ  accennato, puÃ² capitare di fare copia e incolla di statement di log.</p><p>Ogni volta che faccio copia e incolla, mi si accende una speciale lampadina
nella testa che serve a ricordarmi:</p><blockquote><p>controlla ciÃ² che hai copiato almeno due volte perchÃ© sicuramente hai
dimenticato di modificare qualcosa</p></blockquote><p>Questo vale piÃ¹ in generale e non solo per i messaggi di log. Se avessi un euro
per ogni frammento di codice sbagliato per via di un copia e incolla
frettoloso, in questo momento sarei sulla spiaggia di unâ€™isola tropicale a
sorseggiare cocktail attorniato da compiacenti signorine.</p><h1 id=eccezioni>Eccezioni</h1><p>Il log di un errore dovrebbe portarsi dietro lâ€™istanza di eccezione catturata
e, se possibile ed utile, un minimo di contesto. Spesso mi capita di vedere
codice del tipo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ConnectionException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Sarebbe meglio una cosa del genere:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ConnectionException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connection error: user={}&#34;</span><span style=color:#f92672>,</span> user<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>In questo modo non perdo lo stack trace dellâ€™eccezione catturata e posso
ricondurla ad una specifica istanza di utente.</p><h1 id=conosci-gli-strumenti>Conosci gli strumenti</h1><p>Altrettanto importante Ã¨ conoscere i meccanismi di deployment e configurazione
del framework che stai usando. Potrebbe tornarti utile ad esempio impostare un
filtro specifico su un certo logger. Impara inoltre a conoscere i meccanismi di
formattazione dei messaggi.</p><p>Configurando opportunamente un formatter, i framework moderni permettono di
tracciare ad esempio timestamp al millisecondo, nomi di classi, metodi e nome
del thread. Il nome del thread Ã¨ essenziale in unâ€™applicazione concorrente per
seguire il flusso di esecuzione.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://mirkocaserta.com/tags/logging/>logging</a></span>
<span class=tag><a href=https://mirkocaserta.com/tags/java/>java</a></span>
<span class=tag><a href=https://mirkocaserta.com/tags/software-development/>software development</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://mirkocaserta.com/categories/software-development/>software development</a></span></p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=https://mirkocaserta.com/bundle.min.cf7fb2a9e24608a783e05e4472da2fdf008293289de1ad88d1cba5c143e7e414496dd33b6a228e92f8461ce0c8cbad3c9f9847e73e46dfbce0463393ddd1733a.js integrity="sha512-z3+yqeJGCKeD4F5Ectov3wCCkyid4a2I0culwUPn5BRJbdM7aiKOkvhGHODIy608n5hH5z5G37zgRjOT3dFzOg=="></script></body></html>