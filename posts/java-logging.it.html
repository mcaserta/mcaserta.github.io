<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrivi messaggi di log decenti, altrimenti Ges√π piange - Mirko Caserta</title>
    <meta name="description" content="Vorrei proporre alcune considerazioni sulla apparentemente oscura arte dello scrivere messaggi di log. Dico apparentemente oscura perch√© si tratta di un arg...">

    

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="alternate" type="application/atom+xml" title="Mirko Caserta - Feed" href="../feed.xml">
</head>
<body class="">
    <div class="layout-container has-toc">
        <nav class="top-nav">
            <a href="../index.html" class="site-title">Mirko Caserta</a>
            <div class="nav-controls">
                


<a href="java-logging.it.pdf" class="pdf-download" aria-label="Download PDF" title="Download as PDF">
    <span class="pdf-icon">üìÑ</span>
</a>


                
                <button class="toc-toggle" onclick="toggleToc()" aria-label="Toggle table of contents" aria-controls="toc-sidebar">
                    <span class="toc-label">TOC</span>
                </button>
                
                <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="Toggle menu">
                    <span class="hamburger-icon">‚ò∞</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <span class="theme-icon">üåì</span>
                </button>
            </div>
        </nav>

        <!-- Mobile dropdown menu -->
        <div class="mobile-menu" id="mobile-menu">
            <ul class="mobile-page-links">
                
                <li><a href="../pages/about.html">About</a></li>
                
                <li><a href="../pages/contacts.html">Contacts</a></li>
                
                <li><a href="../pages/cv.html">Curriculum Vitae</a></li>
                
            </ul>
        </div>

        <aside class="sidebar">
            <ul class="page-links">
                
                <li><a href="../pages/about.html">About</a></li>
                
                <li><a href="../pages/contacts.html">Contacts</a></li>
                
                <li><a href="../pages/cv.html">Curriculum Vitae</a></li>
                
            </ul>
        </aside>

        
        <aside class="toc-sidebar" id="toc-sidebar">
            <div class="toc">
                <h2>Table of Contents</h2>
                <ul class="toc">
<li><a href="#niente-guerre-di-religione-altrimenti-feuerbach-piange">Niente guerre di religione, altrimenti Feuerbach piange</a></li>
<li><a href="#garbage-in-garbage-out">Garbage in, garbage out</a></li>
<li><a href="#loggare-a-un-certo-livello">Loggare a un certo livello</a></li>
<li><a href="#formattazione-coerente-e-senza-fronzoli">Formattazione coerente e senza fronzoli</a></li>
<li><a href="#metti-i-messaggi-in-riga">Metti i messaggi in riga</a></li>
<li><a href="#occhio-al-copia-e-incolla">Occhio al copia e incolla</a></li>
<li><a href="#eccezioni">Eccezioni</a></li>
<li><a href="#conosci-gli-strumenti">Conosci gli strumenti</a></li>
</ul>
            </div>
        </aside>
        

        <main class="main-content ">
            
<article class="post-article">
    <div class="post-header">
        <h1 class="post-title">Scrivi messaggi di log decenti, altrimenti Ges√π piange</h1>
        <div class="meta">October 02, 2009</div>
    </div>
    <div class="post-content"><p>Vorrei proporre alcune considerazioni sulla apparentemente oscura arte dello
scrivere messaggi di log. Dico <em>apparentemente oscura</em> perch√© si tratta di un
argomento apparentemente banale ma che in realt√† si rivela complesso.</p>
<p>Trattandosi di osservazioni generali, queste andrebbero prese con una dose di
buon senso e sotto stretta osservazione del proctologo di fiducia; ci√≤ non
toglie che con ogni probabilit√† troverai le seguenti note ragionevolmente utili
poich√© basate sull‚Äôesperienza personale (a.k.a. sangue versato sul campo).</p>
<h1 id="niente-guerre-di-religione-altrimenti-feuerbach-piange">Niente guerre di religione, altrimenti Feuerbach piange</h1>
<p>Nel mondo java, log4j √® considerato lo standard de facto quando si parla di
framework di logging. Tuttavia, il mio consiglio √® di usare un framework pi√π
moderno, come slf4j o logback. Logback √® basato sull‚Äôapi di slf4j ed √®
sufficiente dare un‚Äôocchiata agli esempi nella documentazione per essere
produttivi nel giro di un quarto d‚Äôora.</p>
<p>Vorrei evitare di spiegare i vantaggi di questi framework rispetto a log4j o
java.util.logging perch√© credo l‚Äôargomento sia non solo abbondantemente trattato
in letteratura ma anche facilmente foriero di guerre di religione. Le guerre di
religione sono per definizione irrazionali nonch√© mortalmente noiose. Sei
abbastanza intelligente da documentarti e decidere da solo.</p>
<p>Al di l√† di un eventuale framework e del linguaggio di programmazione usato, i
messaggi di log sono essenziali sia in fase di test/debug che in fase di
monitoring in produzione.</p>
<p>Il log √® spesso sottovalutato e trattato come una seccatura che va espletata pi√π
per dovere che per una reale necessit√†. Tuttavia, ti posso assicurare che non
c‚Äô√® nulla di peggio che essere chiamati a risolvere un problema urgente in
produzione e trovarsi davanti a un log incasinato.</p>
<p>Nessuno ti far√† mai collegare col debugger in produzione. I log sono la tua
unica linea di difesa.</p>
<p>In particolare, nel momento in cui qualche migliaio di utenti √® in procinto di
spendere un mucchio di soldi sul sito del tuo cliente e l‚Äôapplicazione √® scritta
da te e per qualche oscuro motivo la possibilit√† di tale ingente esborso dovesse
essere negata agli utenti del suddetto sito, vorrai essere sicuro di avere la
possibilit√† di capire velocemente cosa sta succedendo dietro le quinte. In casi
simili, dire che a scrivere male nel log Ges√π piange √® al massimo un eufemismo
neanche troppo colorito.</p>
<h1 id="garbage-in-garbage-out">Garbage in, garbage out</h1>
<p>Uno dei concetti elementari del software √® quello di input/output. Conoscendo
l‚Äôinput e lo stato di tutte le variabili coinvolte nel processo di elaborazione,
sai che puoi aspettarti un certo output.</p>
<p>Se l‚Äôoutput non √® coerente con le aspettative, vorr√† dire che analizzando il
contesto, l‚Äôinput, il codice e lo stato delle variabili locali e globali
coinvolte, dovresti riuscire a capire cosa non quadra.</p>
<p>Non √® necessario tracciare nel log ogni cambiamento di stato di ogni variabile,
specie se la funzione o il metodo sono sufficientemente complessi.</p>
<p>Esempio di log inutile:</p>
<pre><code class="language-java">public BuyResponse buyItem(BuyRequest request) {
    log.debug(" ----- buyItem ------ start -----");
    // ...
    log.debug(" ----- buyItem ------ stop -----");
    return response;
}
</code></pre>
<p>Esempio di log pi√π utile:</p>
<pre><code class="language-java">public BuyResponse buyItem(BuyRequest request) {
    log.debug("buyItem(): request={}", request);
    // ...
    log.debug("buyItem(): request={}, response={}", request, response);
    return response;
}
</code></pre>
<p>In questo modo posso controllare l‚Äôinput e l‚Äôoutput del metodo. Ripetendo
l‚Äôinput anche all‚Äôuscita del metodo, sar√† pi√π facile correlare i messaggi in
fase di analisi. Tuttavia non sempre √® utile questo tipo di verbosit√†.</p>
<p>Come al solito, il buon senso dovrebbe guidarti nella scelta. Ad ogni modo,
input, output e cambiamenti di stato di variabili importanti andrebbero
tracciati almeno a livello di debug.</p>
<p>Assicurati che le classi che includi nei log abbiano un override sensato del
metodo <code>toString()</code>, altrimenti nei log leggerai solo un mucchio di inutili
indirizzi a puntatori e non lo stato corrente delle variabili degli oggetti.</p>
<h1 id="loggare-a-un-certo-livello">Loggare a un certo livello</h1>
<p>Tutti i framework di logging hanno un meccanismo di livelli per cui √® possibile
filtrare l‚Äôoutput in modo da ottenere solo i messaggi che davvero ci
interessano.</p>
<p>Spesso capita di fare copia e incolla di statement di log per cui un messaggio
che dovrebbe essere a livello di errore invece finisce a livello di debug.
Occhio al copia e incolla!</p>
<h1 id="formattazione-coerente-e-senza-fronzoli">Formattazione coerente e senza fronzoli</h1>
<p>Cerca di mantenere uno stile coerente e senza troppi fronzoli nei messaggi di
log. Disattiva il <em>blocco maiuscole</em>, abbi piet√†. Questo ti aiuter√† nella fase
di analisi ed eviter√† che le tue applicazioni abbiano l‚Äôaspetto di una roba
scritta da uno sbarbatello in visual basic.</p>
<h1 id="metti-i-messaggi-in-riga">Metti i messaggi in riga</h1>
<p>Per quanto possibile, evita di introdurre caratteri di a capo nei messaggi di
log. Quando userai <code>grep</code> per andare alla ricerca dei messaggi, √® importante che
ad una singola riga di output corrisponda un messaggio coerente.</p>
<p>All‚Äôinizio, andare a capo sembra dare un aspetto migliore all‚Äôoutput ma col
tempo ti renderai conto che avresti fatto meglio a non farlo.</p>
<h1 id="occhio-al-copia-e-incolla">Occhio al copia e incolla</h1>
<p><img src="../images/posts/blinking-alarm.gif" alt="Allarme rosso" /></p>
<p>Come gi√† accennato, pu√≤ capitare di fare copia e incolla di statement di log.</p>
<p>Ogni volta che faccio copia e incolla, mi si accende una speciale lampadina
nella testa che serve a ricordarmi:</p>
<blockquote>
<p>controlla ci√≤ che hai copiato almeno due volte perch√© sicuramente hai
dimenticato di modificare qualcosa</p>
</blockquote>
<p>Questo vale pi√π in generale e non solo per i messaggi di log. Se avessi un euro
per ogni frammento di codice sbagliato per via di un copia e incolla frettoloso,
in questo momento sarei sulla spiaggia di un‚Äôisola tropicale a sorseggiare
cocktail attorniato da compiacenti signorine.</p>
<h1 id="eccezioni">Eccezioni</h1>
<p>Il log di un errore dovrebbe portarsi dietro l‚Äôistanza di eccezione catturata e,
se possibile ed utile, un minimo di contesto. Spesso mi capita di vedere codice
del tipo:</p>
<pre><code class="language-java">catch (ConnectionException e) {
    log.error("Error: " + e);
}
</code></pre>
<p>Sarebbe meglio una cosa del genere:</p>
<pre><code class="language-java">catch (ConnectionException e) {
    log.error("connection error: user={}", user, e);
}
</code></pre>
<p>In questo modo non perdo lo stack trace dell‚Äôeccezione catturata e posso
ricondurla ad una specifica istanza di utente.</p>
<h1 id="conosci-gli-strumenti">Conosci gli strumenti</h1>
<p>Altrettanto importante √® conoscere i meccanismi di deployment e configurazione
del framework che stai usando. Potrebbe tornarti utile ad esempio impostare un
filtro specifico su un certo logger. Impara inoltre a conoscere i meccanismi di
formattazione dei messaggi.</p>
<p>Configurando opportunamente un formatter, i framework moderni permettono di
tracciare ad esempio timestamp al millisecondo, nomi di classi, metodi e nome
del thread. Il nome del thread √® essenziale in un‚Äôapplicazione concorrente per
seguire il flusso di esecuzione.</p>
</div>
    
    <div class="post-tags">
        <span class="tag">logging</span><span class="tag">java</span><span class="tag">software development</span>
    </div>
    
    </article>

        </main>
    </div>

    <button id="scroll-to-top" class="scroll-to-top" aria-label="Scroll to top">
        <span>‚Üë</span>
    </button>

    
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/prism-init.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F5NY9DFGS3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-F5NY9DFGS3');
    </script>
    
</body>
</html>


